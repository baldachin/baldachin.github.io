# 重构发布脚本


因为更换文章图片存储的图床，自己之前写的发布脚本只支持本地图片现在无法正常发布带有图床图片地址的文章，所以亟待解决这个问题。如果只是解决发图的问题可能稍加修改就可以，但自己一直想要重构优化代码的心思一直没有落实，刚好趁机一起完成。

原本的代码结构并不理想，结构不合理而且每次出现问题排查起来都非常麻烦，缺乏良性的结构化。比如文档转格式过程中出现的问题就不容易在出现问题的环节直接输出中间结果，每次在发布到线上平台之后排查。另外面向对象也是做得非常不好，只是简单从流程上区分了代码块。

这次重新组织了所有代码并且分成几个角色，尝试采用比较初级的面向对象逻辑来组织。另外也学会先串接代码作为原型，调试通过之后逐步分块组织并随时调试，相比过去闷头写了之后到处出错好了很多。模仿之前看到教程中采用的一些方式优化了原有流程化的结构，让代码有了更多配置的可能。顺便还调整了部分文章样式，放大了正文字号。

发一点牢骚。微信平台的传图接口按照样本示例应该可以直接提交图片内容，但经过反复调试发现官方样本就无法正常通过，只好临时保存本地之后再提交上传，增加很多麻烦。另外微信平台的排版样式有很多特异性，不少在页面文件正常的样式在平台都可能出现异常，还有一些样式直接在上传过程中就会报错却没有任何具体提示，只能自己摸索排查可能的样式问题。

还有很多问题没有完全解决，现在代码安装运行时还会报错无法正常使用，需要进一步排查安装模式中间的问题。另外采用测试代码调试的方式依然没有完全掌握，正在尝试完善。列表样式在平台有严重问题可能需要调整样式代码。

如果没有意外应该一两天之内就可以完成这一波的代码重构，自我感觉水平又有一些提升，继续缓慢成长中。
